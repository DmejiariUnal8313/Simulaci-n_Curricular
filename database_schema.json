{
  "tables": [
    {
      "name": "users",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "email", "type": "VARCHAR(255)", "notNull": true, "unique": true},
        {"name": "email_verified_at", "type": "TIMESTAMP", "nullable": true},
        {"name": "password", "type": "VARCHAR(255)", "notNull": true},
        {"name": "remember_token", "type": "VARCHAR(100)", "nullable": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "subjects",
      "type": "table",
      "columns": [
        {"name": "code", "type": "VARCHAR(10)", "primaryKey": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "semester", "type": "INTEGER", "notNull": true},
        {"name": "credits", "type": "INTEGER", "notNull": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "students",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "document", "type": "VARCHAR(20)", "nullable": true, "unique": true},
        {"name": "progress_percentage", "type": "DECIMAL(5,2)", "notNull": true, "default": "0.00"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "student_subject",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "student_id", "type": "BIGINT", "notNull": true, "foreignKey": "students.id"},
        {"name": "subject_code", "type": "VARCHAR(10)", "notNull": true, "foreignKey": "subjects.code"},
        {"name": "grade", "type": "DECIMAL(3,1)", "nullable": true},
        {"name": "status", "type": "ENUM('enrolled','passed','failed','withdrawn')", "notNull": true, "default": "'enrolled'"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ],
      "indexes": [
        {"name": "unique_student_subject", "columns": ["student_id", "subject_code"], "unique": true}
      ]
    },
    {
      "name": "subject_prerequisites",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "subject_code", "type": "VARCHAR(10)", "notNull": true, "foreignKey": "subjects.code"},
        {"name": "prerequisite_code", "type": "VARCHAR(10)", "notNull": true, "foreignKey": "subjects.code"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ],
      "indexes": [
        {"name": "unique_prerequisite", "columns": ["subject_code", "prerequisite_code"], "unique": true}
      ]
    },
    {
      "name": "external_curriculums",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "institution", "type": "VARCHAR(255)", "nullable": true},
        {"name": "description", "type": "TEXT", "nullable": true},
        {"name": "uploaded_file", "type": "VARCHAR(255)", "nullable": true},
        {"name": "metadata", "type": "JSON", "nullable": true},
        {"name": "status", "type": "ENUM('active','inactive')", "notNull": true, "default": "'active'"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "external_subjects",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "external_curriculum_id", "type": "BIGINT", "notNull": true, "foreignKey": "external_curriculums.id"},
        {"name": "code", "type": "VARCHAR(255)", "notNull": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "credits", "type": "INTEGER", "notNull": true},
        {"name": "semester", "type": "INTEGER", "notNull": true},
        {"name": "description", "type": "TEXT", "nullable": true},
        {"name": "additional_data", "type": "JSON", "nullable": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ],
      "indexes": [
        {"name": "unique_external_subject_code", "columns": ["external_curriculum_id", "code"], "unique": true}
      ]
    },
    {
      "name": "subject_convalidations",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "external_curriculum_id", "type": "BIGINT", "notNull": true, "foreignKey": "external_curriculums.id"},
        {"name": "external_subject_id", "type": "BIGINT", "notNull": true, "foreignKey": "external_subjects.id"},
        {"name": "internal_subject_code", "type": "VARCHAR(10)", "nullable": true, "foreignKey": "subjects.code"},
        {"name": "convalidation_type", "type": "ENUM('direct','free_elective','not_convalidated')", "notNull": true},
        {"name": "notes", "type": "TEXT", "nullable": true},
        {"name": "equivalence_percentage", "type": "DECIMAL(5,2)", "notNull": true, "default": "100.00"},
        {"name": "status", "type": "ENUM('pending','approved','rejected')", "notNull": true, "default": "'pending'"},
        {"name": "approved_by", "type": "VARCHAR(255)", "nullable": true},
        {"name": "approved_at", "type": "TIMESTAMP", "nullable": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ],
      "indexes": [
        {"name": "unique_external_internal_convalidation", "columns": ["external_subject_id", "internal_subject_code"], "unique": true}
      ]
    },
    {
      "name": "student_convalidations",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "student_id", "type": "BIGINT", "notNull": true, "foreignKey": "students.id"},
        {"name": "external_curriculum_id", "type": "BIGINT", "notNull": true, "foreignKey": "external_curriculums.id"},
        {"name": "convalidation_results", "type": "JSON", "notNull": true},
        {"name": "total_convalidated_credits", "type": "INTEGER", "notNull": true, "default": "0"},
        {"name": "total_lost_credits", "type": "INTEGER", "notNull": true, "default": "0"},
        {"name": "progress_impact", "type": "DECIMAL(5,2)", "notNull": true, "default": "0.00"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "simulation_versions",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "name", "type": "VARCHAR(255)", "notNull": true},
        {"name": "description", "type": "TEXT", "nullable": true},
        {"name": "curriculum_changes", "type": "JSON", "notNull": true},
        {"name": "status", "type": "ENUM('draft','active','exported')", "notNull": true, "default": "'draft'"},
        {"name": "exported_at", "type": "TIMESTAMP", "nullable": true},
        {"name": "external_curriculum_id", "type": "BIGINT", "nullable": true, "foreignKey": "external_curriculums.id"},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "simulation_subjects",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "simulation_version_id", "type": "BIGINT", "notNull": true, "foreignKey": "simulation_versions.id"},
        {"name": "subject_code", "type": "VARCHAR(10)", "notNull": true, "foreignKey": "subjects.code"},
        {"name": "action", "type": "ENUM('add','remove','modify')", "notNull": true},
        {"name": "original_data", "type": "JSON", "nullable": true},
        {"name": "new_data", "type": "JSON", "nullable": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    },
    {
      "name": "student_simulation_results",
      "type": "table",
      "columns": [
        {"name": "id", "type": "BIGINT", "primaryKey": true, "autoIncrement": true},
        {"name": "simulation_version_id", "type": "BIGINT", "notNull": true, "foreignKey": "simulation_versions.id"},
        {"name": "student_id", "type": "BIGINT", "notNull": true, "foreignKey": "students.id"},
        {"name": "original_progress", "type": "DECIMAL(5,2)", "notNull": true},
        {"name": "simulated_progress", "type": "DECIMAL(5,2)", "notNull": true},
        {"name": "progress_change", "type": "DECIMAL(5,2)", "notNull": true},
        {"name": "affected_subjects", "type": "JSON", "notNull": true},
        {"name": "created_at", "type": "TIMESTAMP", "notNull": true},
        {"name": "updated_at", "type": "TIMESTAMP", "notNull": true}
      ]
    }
  ],
  "relationships": [
    {
      "from": "student_subject.student_id",
      "to": "students.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "student_subject.subject_code",
      "to": "subjects.code",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "subject_prerequisites.subject_code",
      "to": "subjects.code",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "subject_prerequisites.prerequisite_code",
      "to": "subjects.code",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "external_subjects.external_curriculum_id",
      "to": "external_curriculums.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "subject_convalidations.external_curriculum_id",
      "to": "external_curriculums.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "subject_convalidations.external_subject_id",
      "to": "external_subjects.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "subject_convalidations.internal_subject_code",
      "to": "subjects.code",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "student_convalidations.student_id",
      "to": "students.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "student_convalidations.external_curriculum_id",
      "to": "external_curriculums.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "simulation_versions.external_curriculum_id",
      "to": "external_curriculums.id",
      "type": "many-to-one",
      "onDelete": "SET NULL"
    },
    {
      "from": "simulation_subjects.simulation_version_id",
      "to": "simulation_versions.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "simulation_subjects.subject_code",
      "to": "subjects.code",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "student_simulation_results.simulation_version_id",
      "to": "simulation_versions.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    },
    {
      "from": "student_simulation_results.student_id",
      "to": "students.id",
      "type": "many-to-one",
      "onDelete": "CASCADE"
    }
  ]
}
